<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>XT多账号交易前端</title>
    <style>
        body { font-family: '微软雅黑', Arial, sans-serif; margin: 30px; }
        label { display: inline-block; min-width: 90px; }
        input, select { margin-bottom: 12px; padding: 4px; }
        #result { margin-top: 16px; color: green; }
    </style>
</head>
<body>
    <h2>XT多账号下单前端 Demo</h2>
    <div>
        <label>资金账号：</label>
        <select id="account_id"></select><br>
        <label>合约代码：</label>
        <input id="code" placeholder="如 i2509"><br>
        <label>市场代码：</label>
        <input id="market" value="SHFE"><br>
        <label>价格：</label>
        <input id="price" type="number" step="0.01"><br>
        <label>数量：</label>
        <input id="volume" type="number" value="1"><br>
        <label>价格类型：</label>
        <select id="price_type">
            <option value="1">限价</option>
            <option value="2">市价</option>
            <!-- 你可以按 EPriceType 枚举补全 -->
        </select><br>
        <label>操作类型：</label>
        <select id="operation_type">
            <option value="1">开多</option>
            <option value="2">开空</option>
            <option value="3">平多</option>
            <option value="4">平空</option>
            <!-- 你可以按 EOperationType 枚举补全 -->
        </select><br>
        <label>超价百分比：</label>
        <input id="super_price_rate" type="number" value="0" step="0.01"><br>
        <button onclick="placeOrder()">下单</button>
    </div>
    <div id="result"></div>

    <script>
        // 拉取账号列表，自动填充
        fetch('/api/account_list')
            .then(res => res.json())
            .then(data => {
                const sel = document.getElementById('account_id');
                data.accounts.forEach(acc => {
                    let opt = document.createElement('option');
                    opt.value = acc;
                    opt.text = acc;
                    sel.appendChild(opt);
                });
            });

        function placeOrder() {
            const params = {
                account_id: document.getElementById('account_id').value,
                code: document.getElementById('code').value.trim(),
                market: document.getElementById('market').value.trim(),
                price: document.getElementById('price').value,
                volume: document.getElementById('volume').value,
                price_type: document.getElementById('price_type').value,
                operation_type: document.getElementById('operation_type').value,
                super_price_rate: document.getElementById('super_price_rate').value || "0"
            };

            fetch('/api/order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(params)
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('result').innerText = data.success
                    ? '下单成功：' + data.msg
                    : '下单失败：' + data.msg;
            })
            .catch(err => {
                document.getElementById('result').innerText = '网络或服务器错误：' + err;
            });
        }
    </script>
</body>
</html>
